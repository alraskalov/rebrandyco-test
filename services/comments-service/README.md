# Comment Service

## Описание

Comment Service — это микросервис, который отвечает за управление комментариями пользователей. Он предоставляет возможность создания, обновления, удаления и получения комментариев, а также поддерживает авто-удаление комментариев через установленное время (минута, час, день, неделя). Микросервис обрабатывает запросы, поступающие через API Gateway, и выполняет все операции с базой данных для комментариев.

### Основные функции:

- Создание комментариев.
- Обновление комментариев.
- Удаление комментариев.
- Авто-удаление комментариев через указанный интервал времени.
- Получение списка комментариев пользователя.

## Структура

- **comments.controller.ts** — Обрабатывает запросы, связанные с комментариями (создание, обновление, удаление, получение комментариев).
- **comments.service.ts** — Содержит бизнес-логику для работы с комментариями (включая автоудаление).
- **comments.entity.ts** — Определяет структуру сущности Comment, включая поля, такие как `text`, `userId`, `autoDeleteAfter` и `createdAt`.
- **cron.service.ts** — Реализует задачу для автоматического удаления комментариев по истечению времени.
- **main.ts** — Инициализация приложения.

## Зависимости

- **NestJS** — Основной фреймворк для создания серверного приложения.
- **TypeORM** — ORM для работы с базой данных и взаимодействия с сущностями.
- **@nestjs/microservices** — Для взаимодействия с API Gateway через TCP-транспорт.
- **@nestjs/schedule** — Для работы с Cron задачами.
- **swagger** — Для генерации API Документации.
- **class-validator** — Для валидации входных данных в DTO.

## Как работает Comment Service

1. **Создание комментария**:

   - Метод `addComment` принимает текст комментария и автоматически привязывает его к текущему пользователю.
   - Комментарий сохраняется в базе данных, и если указано время для авто-удаления, оно сохраняется в поле `autoDeleteAfter`.

2. **Обновление комментария**:

   - Метод `updateComment` позволяет изменить текст комментария.
   - Если текст не изменился, сразу же возвращается неизмененный комментарий, без дополнительных взаимодействий с БД.
   - Обновляется только тот комментарий, который был создан текущим пользователем.

3. **Удаление комментария**:

   - Метод `deleteComment` удаляет комментарий из БД.

4. **Авто-удаление комментариев**:

   - Каждую минуту запускается Cron задача, которая проверяет все комментарии с заданным полем `autoDeleteAfter`.
   - Если время для авто-удаления истекло, комментарий удаляется из БД.

5. **Получение комментариев**:

   - Метод `getUserComments` позволяет пользователю с ролью `admin` получить комментарии любого пользователя, если указан `userId` (в т.ч и свои).
   - Метод `getMeComments` позволяет получить комментарии текущего авторизованного пользователя.

## Как запустить

1. Установите зависимости:

   ```bash
   npm install
   ```

2. Запустите приложение:

   ```bash
   npm run start
   ```
